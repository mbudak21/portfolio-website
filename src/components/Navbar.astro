---
// Navbar.astro
export interface Link { href: string; label: string }
import { getLangFromUrl, useTranslations } from '../../i18n/utils';

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

const domains = [
  { href: 'mbudak21.com/en'},
  { href: 'mbudak21.com/tr'},
  { href: 'mbudak21.com/ru'}
]

const links = [
  { href: `/${lang}/`, label: t('navbar.home') },
  { href: `/${lang}/projects`, label: t('navbar.projects') },
  { href: `/${lang}/blog`, label: t('navbar.blog') },
  { href: `/${lang}/contact`, label: t('navbar.contact') },
];
---

<nav class="nav glass" aria-label="Main">

  <!-- <a class="dropdown brand" href="/">mbudak21.com</a> -->
   <div class="domain-div">
    <button class="domain" aria-label="Domains" aria-expanded="false"> mbudak21.com
      <span class="domains"></span>
    </button>
   </div>



  <div class="links" role="menubar">
    {links.map(l => <a class="link" role="menuitem" href={l.href}>{l.label}</a>)}
  </div>

  <button class="burger" aria-label="Menu" aria-expanded="false">
    <span class="bar"></span>
  </button>
</nav>

<div class="glass drawer" id="drawer">
  {links.map(l => <a href={l.href} class="link">{l.label}</a>)}
</div>


<style>
  :root { --nav-h: 56px; }

  .nav {
    height: var(--nav-h);
    display: flex;
    align-items: center;
    justify-content: space-between;

    color: var(--font-color);
    padding: 0 1rem;
    position: sticky;
    top: 0;
    border-bottom: 1px solid var(--border-color);
    z-index: 10;
  }

  .domain-div {
    position: relative;
    display: inline-flex;
    align-items: center;
    justify-content: center;
  }

  .domain {
    all: unset;
    font-family: inherit;
    font-size: 18px;
    font-weight: 700; 
    letter-spacing: .4px;

    padding: 0.3rem 1.1rem 0.3rem 0.5rem;

    color: var(--heading-color);
    background-color: transparent;

    border-radius: 10px;
    border-width: 0px;

    outline: none;
    appearance: none;
    -webkit-appearance: none;
    -moz-appearance: none;
  }
  .domain:active {
    box-shadow: none;
    border-color: transparent;
    background-color: inherit;
  }
  .domain:hover {
    cursor: pointer;
    border-color: #aaaaaa6b;
    border-color: var(--font-color); 
    background-color: rgba(127, 127, 127, 0.08);
  }
  .domain::after {
    content: "";
    position:absolute;

    top: 5px;
    right: 7px;
    width: 5px;
    height: 5px;
    border-right: 1.5px solid var(--font-color);
    border-bottom: 1.5px solid var(--font-color);

    transform: rotate(45deg);

    opacity: 0.5;
    transition: opacity 0.2s ease;
  }
  .domain:hover::after {
    opacity: 1;
  }

  .brand {
    font-weight: 700; letter-spacing: .4px;
    color: var(--heading-color); text-decoration: none;
  }

  .links {
    display: none; gap: 1rem; align-items: center;
  }

  .link {
    position: relative; text-decoration: none; color: var(--font-color);
    padding: .4rem .2rem; font-weight: 600;
    max-width: 100px;
  }
  /* animated underline */
  .link::after {
    content: ""; position: absolute; left: 0; bottom: -2px; height: 2px; width: 100%;
    background: var(--highlight-color);
    transform: scaleX(0); transform-origin: left; transition: transform .25s ease;
  }
  .link:hover::after, .link:focus-visible::after { transform: scaleX(1); }

  /* hamburger */
  .burger {
    width: 34px; height: 28px; display: grid; place-items: center;
    border: 0; background: transparent; cursor: pointer;
  }
  .bar, .bar::before, .bar::after {
    display: block; width: 22px; height: 2px; background: var(--font-color);
    transition: transform .25s ease, opacity .2s ease;
    content: "";
  }
  .bar { position: relative; }
  .bar::before { position: absolute; transform: translateY(-7px); }
  .bar::after  { position: absolute; transform: translateY(7px); }
  .burger[aria-expanded="true"] .bar   { transform: rotate(45deg); }
  .burger[aria-expanded="true"] .bar::before { opacity: 0; }
  .burger[aria-expanded="true"] .bar::after  { transform: rotate(-90deg); }

/* mobile drawer */
  .drawer {
    position: fixed; 
    inset: var(--nav-h) 0 auto 0; 

    width: 90%;
    margin-inline: auto;
    
    background: var(--glass-background); 
    backdrop-filter: blur(12px) saturate(1.8);
    -webkit-backdrop-filter: blur(12px) saturate(1.8);
    border-top: 1px solid var(--border-color);
    border-radius: 0 0 1rem 1rem;
    
    display: grid; gap: .4rem; padding: .8rem 1rem;
    
    max-height: 0; 
    overflow: hidden;
    opacity: 0;
    
    z-index: 9; 

    transition: max-height .3s ease, opacity .2s ease;
  }

  .drawer.open {
    max-height: 50vh; 
    opacity: 1; 
  }
  
  .drawer a { padding: .6rem 0; text-decoration: none; color: var(--font-color); }

  /* desktop */
  @media (min-width: 768px) {
    .burger { display: none; }
    .links { display: flex; }
    .drawer { display: none; }
  }

  @media (prefers-reduced-motion: reduce) {
    .link::after, .bar, .bar::before, .bar::after, .drawer { transition: none; }
  }
</style>


<script is:inline>
  const btn = document.querySelector('.burger');
  const drawer = document.getElementById('drawer');
  btn?.addEventListener('click', () => {
    const open = btn.getAttribute('aria-expanded') === 'true';
    btn.setAttribute('aria-expanded', String(!open));
    drawer?.classList.toggle('open', !open);
  });
  // close on route change (Astro SPA/partial hydration not needed here, safe default)
  window.addEventListener('pageshow', () => {
    btn?.setAttribute('aria-expanded', 'false');
    drawer?.classList.remove('open');
  });
</script>
